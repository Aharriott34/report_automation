import pandas as pd
import numpy as np
import re


# Excel files to load in
tv_calls_file = pd.read_csv(r"C:\Users\aharriott\Downloads\production_results_1943001_Report_2021-12-07_call_details_20211213-1-18pnfzr_original.csv")
summary_by_media_calls = pd.read_csv(r"C:\Users\aharriott\Downloads\2021-12-16_summary_by_multi_level (2).csv")

# TV Call total
def tv_calls(file):
    del file['Phone Type']
    del file['Signal Names']
    del file['Revenue (Sale Amount)']
    del file['Recording']
    file['hour'] = file.Timestamp.apply(lambda x: str(x).split("")[1].split(':')[0])
    file_pivot = pd.pivot_table(data=file,values=len(file['Call Record ID']), columns=file['hour']).reset_index()
    return file_pivot

# print(tv_calls(excel_file))
# print(excel_file['Call Start Time'])

# Summary By Media Raw Calls
def summary_by_media(file):
    file_xtab = pd.crosstab(index=file['Publisher'], columns=['Calls'], values=file['Calls'], aggfunc=np.sum, dropna=True).reset_index()
    return file_xtab

print(summary_by_media(summary_by_media_calls))

def sum_by_media(file, substr):
    file_xtab = pd.crosstab(index=file['Publisher'], columns=['Calls'], values=file['Calls'], aggfunc=np.sum, dropna=True).reset_index()
    idx_of_publisher = file_xtab['Publisher'].str.contains(substr)
    publisher_count = file_xtab[idx_of_publisher]['Calls'].sum()
    return publisher_count


def sum_raw_calls():
    print('Summary By Media: Raw Calls')
    print_substr = 'CONVERGE'
    print(f'Print: {sum_by_media(summary_by_media_calls,print_substr)}')

    print_insert_substr = "Incremental -"
    print(f'Print - Inserts: {sum_by_media(summary_by_media_calls,print_insert_substr)}')

    mailer_substr = "Incremental Mailer"
    mailer_substr_2 = 'Incremental BLEND'
    mailer_total_1 = sum_by_media(summary_by_media_calls,mailer_substr)
    mailer_total_2 = sum_by_media(summary_by_media_calls,mailer_substr_2)
    total_mailer = mailer_total_1 + mailer_total_2
    print(f'Mailer: {total_mailer}')

    mailer_bfyt_mch_substr = 'BFYT Doty Mailer MCH'
    print(f'Mailer BFYT MCH: {sum_by_media(summary_by_media_calls,mailer_bfyt_mch_substr)}')

    doty_incremental = "BFYT Doty Incremental"
    print(f'DOTY Incremental: {sum_by_media(summary_by_media_calls, doty_incremental)}')

    doty_mspark = "BFYT Doty MSPARK"
    print(f'DOTY Mspark: {sum_by_media(summary_by_media_calls,doty_mspark)}')

    web_substr = 'MEDICARE COVERAGE HELPLINE'
    web_substr_2 = '2021 Medicare Helpline'
    web_count_1 = sum_by_media(summary_by_media_calls,web_substr)
    web_count_2 = sum_by_media(summary_by_media_calls,web_substr_2)
    web_total = web_count_1 + web_count_2
    print(f'Web: {web_total}')

    mch_fb_goog_bing = 'BFYT FB, GOOG, BING'
    print(f'MCH, FB, GOOG, BING: {sum_by_media(summary_by_media_calls, mch_fb_goog_bing)}')

    bringans = 'Bringans'
    print(f'Bringans: {sum_by_media(summary_by_media_calls, bringans)}')
    print('Sunrise Third Party Affiliate: N/A')

    rtn = 'RTN'
    print(f'RTN Medicare: {sum_by_media(summary_by_media_calls, rtn)}')
    print('My Health Angel: N/A')

    lls = 'LLS'
    print(f'LLS: {sum_by_media(summary_by_media_calls, lls)}')

    bayfront = 'Bayfront'
    print(f'Bayfront: {sum_by_media(summary_by_media_calls, bayfront)}')

    malbis = 'Malbis'
    print(f'Malbis: {sum_by_media(summary_by_media_calls, malbis)}')

    total = sum_by_media(summary_by_media_calls,print_substr) + sum_by_media(summary_by_media_calls,print_insert_substr) + total_mailer + sum_by_media(summary_by_media_calls,mailer_bfyt_mch_substr) + sum_by_media(summary_by_media_calls, doty_incremental) + sum_by_media(summary_by_media_calls,doty_mspark) + web_total + sum_by_media(summary_by_media_calls, mch_fb_goog_bing) + sum_by_media(summary_by_media_calls, bringans) + sum_by_media(summary_by_media_calls, lls) + sum_by_media(summary_by_media_calls, bayfront) + sum_by_media(summary_by_media_calls, malbis)

    return print(f'Total Count: {total}')
print(sum_raw_calls())
